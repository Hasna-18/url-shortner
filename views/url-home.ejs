<h1>Welcome, <%= user.email %></h1>

<div class="nav-links">
    <a href="/users/add-url">Add New URL</a>
    <a href="#" id="logoutBtn">Logout</a>
</div>

<form class="search-form" method="GET" action="/url-home">
    <input type="text" name="search" placeholder="Search by title or URL..." value="<%= search || '' %>" />
    <button type="submit">Search</button>
</form>

<hr>

<h3>Your URLs</h3>

<% if (urls && urls.length > 0) { %>
    <p class="url-count">Showing <%= urls.length %> of <%= total %> URLs</p>
    
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Original URL</th>
                <th>Short URL</th>
                <th>Created At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% urls.forEach(url => { %>
                <tr>
                    <td><%= url.title %></td>
                    <td><a href="<%= url.originalUrl %>" target="_blank"><%= url.originalUrl %></a></td>
                    <td><a href="/<%= url.shortUrl %>" target="_blank">http://localhost:3000/<%= url.shortUrl %></a></td>
                    <td><%= url.createdAt.toLocaleString() %></td>
                    <td>
                        <a href="/users/edit-url/<%= url._id %>">Edit</a> 
                        <form action="/users/delete-url/<%= url._id %>" method="POST" style="display: inline;">
                            <button type="submit" onclick="return confirm('Are you sure you want to delete this URL?')">Delete</button>
                        </form>
                    </td>
                </tr>
            <% }) %>
        </tbody>
    </table>

    <% if (totalPages > 1) { %>
        <div class="pagination">
            <% if (currentPage > 1) { %>
                <a href="/url-home?page=<%= currentPage - 1 %><%= search ? '&search=' + search : '' %>">← Previous</a>
            <% } %>
            
            <% for (let i = 1; i <= totalPages; i++) { %>
                <% if (i === currentPage) { %>
                    <span><%= i %></span>
                <% } else { %>
                    <a href="/url-home?page=<%= i %><%= search ? '&search=' + search : '' %>"><%= i %></a>
                <% } %>
            <% } %>
            
            <% if (currentPage < totalPages) { %>
                <a href="/url-home?page=<%= currentPage + 1 %><%= search ? '&search=' + search : '' %>">Next →</a>
            <% } %>
        </div>
    <% } %>
<% } else { %>
    <p>No URLs found. <a href="/users/add-url">Add your first URL</a></p>
<% } %>

<% if (typeof error !== 'undefined' && error) { %>
    <p class="error"><%= error %></p>
<% } %>

<!-- Logout Confirmation Modal -->
<div id="logoutModal" class="modal">
    <div class="modal-content">
        <h3>Confirm Logout</h3>
        <p>Are you sure you want to logout?</p>
        <div class="modal-buttons">
            <button id="confirmLogout">Yes</button>
            <button id="cancelLogout">No</button>
        </div>
    </div>
</div>

<script>
    const logoutBtn = document.getElementById("logoutBtn");
    const modal = document.getElementById("logoutModal");
    const confirmBtn = document.getElementById("confirmLogout");
    const cancelBtn = document.getElementById("cancelLogout");

    logoutBtn.addEventListener("click", (e) => {
        e.preventDefault();
        modal.style.display = "flex";
    });

    confirmBtn.addEventListener("click", () => {
        window.location.href = "/users/logout";
    });

    cancelBtn.addEventListener("click", () => {
        modal.style.display = "none";
    });

    // Close modal if clicked outside
    window.addEventListener("click", (e) => {
        if (e.target === modal) {
            modal.style.display = "none";
        }
    });
</script>